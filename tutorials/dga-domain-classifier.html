<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="DGA domain classifier (Keras-ONNX)" href="dga-domain-classifier-keras-onnx.html" /><link rel="prev" title="Tutorials" href="index.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>DGA domain classifier - ML Model Manager Client documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">ML Model Manager Client  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">ML Model Manager Client  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../user_guide/index.html">Userâ€™s Guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/client-object.html">Client Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/functions-facade.html">Functions Facade</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/authentication.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/downloaders.html">Downloaders</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">DGA domain classifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="dga-domain-classifier-keras-onnx.html">DGA domain classifier (Keras-ONNX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="dga-domain-scoring-gbm-onnx.html">DGA domain scoring (GBM-ONNX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="entity-classification-kmeans-onnx.html">Entity classification (kmeans-ONNX)</a></li>
<li class="toctree-l2"><a class="reference internal" href="entity-classification-flow.html">Entity classification with Flow</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api_reference/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/modelmanager.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">devo_ml.modelmanager</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/api.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">devo_ml.modelmanager.api</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/auth.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">devo_ml.modelmanager.auth</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/downloader.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">devo_ml.modelmanager.downloader</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/engines.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">devo_ml.modelmanager.engines</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/error.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">devo_ml.modelmanager.error</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/profile.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">devo_ml.modelmanager.profile</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/validator.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">devo_ml.modelmanager.validator</span></code></a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="dga-domain-classifier">
<h1>DGA domain classifier<a class="headerlink" href="#dga-domain-classifier" title="Permalink to this heading">#</a></h1>
<p>This tutorial shows how to perform real-time <cite>DGA</cite> domain classification using
a machine learning model for logs stored in the <a class="reference external" href="https://www.devo.com">Devo</a>
platform.</p>
<p>Domain generation algorithms, <cite>DGA</cite>, are algorithms seen in various families of
malware that are used to periodically generate a large number of domain names
that can be used as rendezvous points with their command and control servers.</p>
<p>For example, an infected computer could create thousands of domain names such
as: www.&lt;gibberish&gt;.com and would attempt to contact a portion of these with
the purpose of receiving an update or commands. See
<a class="reference external" href="https://en.wikipedia.org/wiki/Domain_generation_algorithm">DGA on Wikipedia</a>
to learn more about domain generation algorithms.</p>
<p>We are going to develop a simple machine learning model capable of classifying
malicious domains in the <em>demo.ecommerce.data</em> table. We will use the Machine
Learning <a class="reference external" href="https://h2o.ai/">H2O AI</a> framework to build and train our model,
the Machine Learning Model Manager Client to register it on the Devo platform,
and the <a class="reference external" href="https://github.com/DevoInc/python-sdk">Devo Python SDK</a> framework to
evaluate and classify in real time the domains in the table using a query.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://github.com/DevoInc/python-mlmodelmanager-client/blob/main/notebooks/dga-domain-classifier.ipynb">The tutorial is available as a Jupyter notebook</a>.</p>
</div>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Python &gt;= 3.7.</p></li>
<li><p>Devo table <code class="docutils literal notranslate"><span class="pre">demo.ecommerce.data</span></code>.</p></li>
</ul>
<p>It is recommended for convenience to create a virtual environment to run the
tutorial or use the notebook provided.</p>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h2>
<p>Letâ€™s start by installing the required packages.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>devo-sdk
$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>devo-mlmodelmanager
$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>h2o
</pre></div>
</div>
<p>Then the needed imports.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">h2o</span>

<span class="kn">from</span> <span class="nn">h2o.estimators</span> <span class="kn">import</span> <span class="n">H2OGradientBoostingEstimator</span>
<span class="kn">from</span> <span class="nn">devo.api</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">ClientConfig</span><span class="p">,</span> <span class="n">SIMPLECOMPACT_TO_OBJ</span>
<span class="kn">from</span> <span class="nn">devo_ml.modelmanager</span> <span class="kn">import</span> <span class="n">create_client_from_token</span><span class="p">,</span> <span class="n">engines</span>
</pre></div>
</div>
<p>Declare some constants for convenience in the code.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># A valid Devo access token</span>
<span class="n">DEVO_TOKEN</span> <span class="o">=</span> <span class="s1">&#39;&lt;your_token_here&gt;&#39;</span>

<span class="c1"># URL of Devo API, e.g. https://apiv2-us.devo.com/search/query/</span>
<span class="n">DEVO_API_URL</span> <span class="o">=</span> <span class="s1">&#39;&lt;devo_api_url_here&gt;&#39;</span>

<span class="c1"># URL of Devo ML Model Manager, e.g. https://api-us.devo.com/mlmodelmanager/</span>
<span class="n">DEVO_MLMM_URL</span> <span class="o">=</span> <span class="s1">&#39;&lt;devo_mlmm_url_here&gt;&#39;</span>

<span class="c1"># The domain to connect to, e.g. self</span>
<span class="n">DOMAIN</span> <span class="o">=</span> <span class="s1">&#39;&lt;your_domain_here&gt;&#39;</span>

<span class="c1"># The name of the model</span>
<span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s1">&#39;dga_classifier&#39;</span>

<span class="c1"># The description of the models</span>
<span class="n">MODEL_DESCRIPTION</span> <span class="o">=</span> <span class="s1">&#39;DGA domain classifier&#39;</span>

<span class="c1"># The path where model file will be stored</span>
<span class="n">MODELS_PATH</span> <span class="o">=</span> <span class="s1">&#39;~/models&#39;</span>

<span class="c1"># The URL of a dataset to build the model</span>
<span class="n">DATASET_URL</span> <span class="o">=</span> <span class="s2">&quot;https://devo-ml-models-public-demos.s3.eu-west-3.amazonaws.com/legit_dga/dataset.csv&quot;</span>

<span class="n">VOWELS</span> <span class="o">=</span> <span class="s2">&quot;aeiouAEIOU&quot;</span>
</pre></div>
</div>
</section>
<section id="prepare-the-data">
<h2>Prepare the data<a class="headerlink" href="#prepare-the-data" title="Permalink to this heading">#</a></h2>
<p>This <a class="reference external" href="https://devo-ml-models-public-demos.s3.eu-west-3.amazonaws.com/legit_dga/dataset.csv">dataset</a>
will help us to train our model once it has been built. The dataset has the
form <code class="docutils literal notranslate"><span class="pre">host;domain;class;subclass</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>host;domain;class;subclass
000directory.com.ar;000directory;legit;legit
000webhost.com;000webhost;legit;legit
001fans.com;001fans;legit;legit
...
1002n0q11m17h017r1shexghfqf.net;1002n0q11m17h017r1shexghfqf;dga;newgoz
1002ra86698fjpgqke1cdvbk5.org;1002ra86698fjpgqke1cdvbk5;dga;newgoz
1008bnt1iekzdt1fqjb76pijxhr.org;1008bnt1iekzdt1fqjb76pijxhr;dga;newgoz
100bestbuy.com;100bestbuy;legit;legit
...
</pre></div>
</div>
<p>We will add the columns <code class="docutils literal notranslate"><span class="pre">length</span></code>, <code class="docutils literal notranslate"><span class="pre">entropy</span></code> and <code class="docutils literal notranslate"><span class="pre">vowel_proportion</span></code> for
each domain, and also the flag <code class="docutils literal notranslate"><span class="pre">malicious</span></code> indicating if it is a DGA domain
according to the <code class="docutils literal notranslate"><span class="pre">class</span></code> column value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># import dataset</span>
<span class="n">domains</span> <span class="o">=</span> <span class="n">h2o</span><span class="o">.</span><span class="n">import_file</span><span class="p">(</span><span class="n">DATASET_URL</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Prepare dataset</span>
<span class="n">domains</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="o">~</span><span class="n">domains</span><span class="p">[</span><span class="s1">&#39;subclass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
<span class="n">domains</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nchar</span><span class="p">()</span>
<span class="n">domains</span><span class="p">[</span><span class="s1">&#39;entropy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">entropy</span><span class="p">()</span>
<span class="n">domains</span><span class="p">[</span><span class="s1">&#39;vowel_proportion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">VOWELS</span><span class="p">:</span>
    <span class="n">domains</span><span class="p">[</span><span class="s1">&#39;vowel_proportion&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">domains</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">countmatches</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">domains</span><span class="p">[</span><span class="s1">&#39;vowel_proportion&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">domains</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span>
<span class="n">domains</span><span class="p">[</span><span class="s1">&#39;malicious&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;legit&#39;</span>
<span class="n">domains</span><span class="p">[</span><span class="s1">&#39;malicious&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="s1">&#39;malicious&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">asfactor</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="build-the-model">
<h2>Build the model<a class="headerlink" href="#build-the-model" title="Permalink to this heading">#</a></h2>
<p>We use the <a class="reference external" href="https://docs.h2o.ai/h2o/latest-stable/h2o-py/docs/index.html">h2o</a>
library to create a model capable of detecting whether a domain is malicious.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h2o</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># split dataset</span>
<span class="n">train</span><span class="p">,</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">domains</span><span class="o">.</span><span class="n">split_frame</span><span class="p">(</span><span class="n">ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">.8</span><span class="p">],</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>

<span class="c1"># create and train the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">H2OGradientBoostingEstimator</span><span class="p">(</span><span class="n">model_id</span><span class="o">=</span><span class="n">MODEL_NAME</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="s1">&#39;entropy&#39;</span><span class="p">,</span> <span class="s1">&#39;vowel_proportion&#39;</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;malicious&#39;</span><span class="p">,</span>
    <span class="n">training_frame</span><span class="o">=</span><span class="n">train</span><span class="p">,</span>
    <span class="n">validation_frame</span><span class="o">=</span><span class="n">valid</span>
<span class="p">)</span>

<span class="c1"># save the model</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">MODELS_PATH</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">download_mojo</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">MODELS_PATH</span><span class="p">)</span>

<span class="n">h2o</span><span class="o">.</span><span class="n">cluster</span><span class="p">()</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="register-the-model">
<h2>Register the model<a class="headerlink" href="#register-the-model" title="Permalink to this heading">#</a></h2>
<p>Once the model has been developed and saved, it must be registered on the
Devo platform in order to exploit it. For this we will use the ML Model Manager
Client.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create the mlmm client</span>
<span class="n">mlmm</span> <span class="o">=</span> <span class="n">create_client_from_token</span><span class="p">(</span><span class="n">DEVO_MLMM_URL</span><span class="p">,</span> <span class="n">DEVO_TOKEN</span><span class="p">)</span>

<span class="c1"># register the model</span>
<span class="n">mlmm</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span>
    <span class="n">MODEL_NAME</span><span class="p">,</span>
    <span class="n">engines</span><span class="o">.</span><span class="n">H2O</span><span class="p">,</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MODELS_PATH</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">MODEL_NAME</span><span class="si">}</span><span class="s2">.zip&quot;</span><span class="p">),</span>
    <span class="n">description</span><span class="o">=</span><span class="n">MODEL_DESCRIPTION</span><span class="p">,</span>
    <span class="n">force</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Refer to <a class="reference internal" href="../user_guide/index.html#user-s-guide"><span class="std std-ref">Userâ€™s Guide</span></a> of this documentation to learn
more about the ML Model Manager Client.</p>
</div>
<p>So far we have everything ready to exploit our model.</p>
</section>
<section id="classify-domains">
<h2>Classify domains<a class="headerlink" href="#classify-domains" title="Permalink to this heading">#</a></h2>
<p>One way to evaluate a model is by querying a table and the
<code class="docutils literal notranslate"><span class="pre">mlevalmodel(...)</span></code> operator available in the Devo query engine capable
of evaluating machine learning models.</p>
<p>We are going to use the <em>demo.ecommerce.data</em> table, which contains the
<code class="docutils literal notranslate"><span class="pre">referralUri</span></code> field, from which we can extract the domain we want to check.</p>
<p>A query that might be worthwhile would be something like this.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;from demo.ecommerce.data</span>
<span class="s1">  select split(referralUri, &quot;/&quot;,2) as domain,</span>
<span class="s1">  float(length(domain)) as length,</span>
<span class="s1">  shannonentropy(domain) as entropy,</span>
<span class="s1">  float(countbyfilter(domain, &quot;</span><span class="si">{</span><span class="n">VOWELS</span><span class="si">}</span><span class="s1">&quot;)) as vowel_proportion,</span>
<span class="s1">  mlevalmodel(&quot;</span><span class="si">{</span><span class="n">DOMAIN</span><span class="si">}</span><span class="s1">&quot;, &quot;</span><span class="si">{</span><span class="n">MODEL_NAME</span><span class="si">}</span><span class="s1">&quot;, length, entropy, vowel_proportion) as class</span>
<span class="s1">&#39;&#39;&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Refer to <a class="reference external" href="https://docs.devo.com/space/latest/95191261/Build+a+query+using+LINQ">Build a query using LINQ</a>
to learn more about queries.</p>
</div>
<p>Well, now we just need to create an access to the Devo API and launch the
query. With the <a class="reference external" href="https://github.com/DevoInc/python-sdk">Devo Python SDK</a>,
among other features, we can execute queries against the Devo platform easily
and securely.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a Devo API client</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span>
    <span class="n">auth</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">DEVO_TOKEN</span><span class="p">},</span>
    <span class="n">address</span><span class="o">=</span><span class="n">DEVO_API_URL</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">ClientConfig</span><span class="p">(</span>
        <span class="n">response</span><span class="o">=</span><span class="s2">&quot;json/simple/compact&quot;</span><span class="p">,</span>
        <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">processor</span><span class="o">=</span><span class="n">SIMPLECOMPACT_TO_OBJ</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="s2">&quot;now()-1*hour()&quot;</span><span class="p">})</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Refer to <a class="reference external" href="https://docs.devo.com/space/latest/95128275">Query API</a>
to learn more about the Devo Query API.</p>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="dga-domain-classifier-keras-onnx.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">DGA domain classifier (Keras-ONNX)</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Tutorials</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Devo ML Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">DGA domain classifier</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#prepare-the-data">Prepare the data</a></li>
<li><a class="reference internal" href="#build-the-model">Build the model</a></li>
<li><a class="reference internal" href="#register-the-model">Register the model</a></li>
<li><a class="reference internal" href="#classify-domains">Classify domains</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    </body>
</html>