{"id":null,"description":"","name":"EvalModelTemplate","type":"app.Context","templateFormat":"%mono","loggedItems":[],"variableConf":{"variables":[{"id":"d310c38c-pa41-iebc-9cfa-d52483cffdbb","name":"OUT_TABLE","description":"Devo table to write to.","type":"string","value":"my.app.evalmodel.demo"},{"id":"55b7c60c-p68a-ie3d-b87c-a298d529b980","name":"QUERY_MODULE","description":"Number to be used in the query to split results in batches.\nShould be the same as 'Times' in MultiplyByNToSplitQuery unit.","type":"integer","value":"24"},{"id":"3af3fd01-p057-i3c0-b64d-9a094eaa0440","name":"EVERY","type":"string","description":"How often query should be launched.","parameterValue":"/5 * * ? * * *","value":"0 0 0 ? * * *","statusName":null},{"id":"c507ffab-pe9f-i33a-a038-0b570ec9e3ec","name":"QUERY_COLUMN","description":"Query column where a function should be applied to divide data into batches","type":"string","value":"clientIpAddress"},{"id":"a720eb10-p945-if9a-b09b-73b5c02b3859","name":"QUERY_DURATION","description":"Duration of the from-to period for query, in milliseconds","type":"long","value":"86400000"}],"variablesSaved":[{"id":"d310c38c-pa41-iebc-9cfa-d52483cffdbb","name":"OUT_TABLE","description":"Devo table to write to.","type":"string","value":"my.app.evalmodel.demo"},{"id":"55b7c60c-p68a-ie3d-b87c-a298d529b980","name":"QUERY_MODULE","description":"Number to be used in the query to split results in batches.\nShould be the same as 'Times' in MultiplyByNToSplitQuery unit.","type":"integer","value":"24"},{"id":"3af3fd01-p057-i3c0-b64d-9a094eaa0440","name":"EVERY","type":"string","description":"How often query should be launched.","parameterValue":"/5 * * ? * * *","value":"0 0 0 ? * * *","statusName":null},{"id":"c507ffab-pe9f-i33a-a038-0b570ec9e3ec","name":"QUERY_COLUMN","description":"Query column where a function should be applied to divide data into batches","type":"string","value":"clientIpAddress"},{"id":"a720eb10-p945-if9a-b09b-73b5c02b3859","name":"QUERY_DURATION","description":"Duration of the from-to period for query, in milliseconds","type":"long","value":"86400000"}],"undefinedVariables":[],"transformationMap":[{"unitName":"SetFromAndToDates","path":"expressions/fields/1/expression","variables":["QUERY_DURATION"],"rawValue":"toTime - #{QUERY_DURATION}","value":"toTime - 86400000L"},{"unitName":"InjectResults","path":"table","variables":["OUT_TABLE"],"rawValue":"#{OUT_TABLE}","value":"my.app.evalmodel.demo"},{"unitName":"QueryData","path":"query","variables":["QUERY_COLUMN","QUERY_MODULE"],"rawValue":"select ? as counter\nfrom demo.ecommerce.data where isnotnull(#{QUERY_COLUMN})\nwhere (abs(hash(#{QUERY_COLUMN}))) %% #{QUERY_MODULE} = counter\nselect\n    hour(eventdate) as hour,\n    minute(eventdate) as minute,\n    second(eventdate) as second,\n    clientIpAddress,\n    userAgent\ngroup every 8h by clientIpAddress\nselect\n    str(clientIpAddress) as sourceIp,\n    float4(size(collectcompact(hour))) as unique_hours,\n    float4(size(collectcompact(minute))) as unique_mins,\n    float4(size(collectcompact(second))) as unique_seconds,\n    float4(size(collectcompact(userAgent))) as unique_user_agents,\n    float4(avg(bytesTransferred)) as bytestransferred,\n    [unique_hours, unique_mins, unique_seconds, unique_user_agents, bytestransferred] as field_0","value":"select ? as counter\nfrom demo.ecommerce.data where isnotnull(clientIpAddress)\nwhere (abs(hash(clientIpAddress))) %% 24 = counter\nselect\n    hour(eventdate) as hour,\n    minute(eventdate) as minute,\n    second(eventdate) as second,\n    clientIpAddress,\n    userAgent\ngroup every 8h by clientIpAddress\nselect\n    str(clientIpAddress) as sourceIp,\n    float4(size(collectcompact(hour))) as unique_hours,\n    float4(size(collectcompact(minute))) as unique_mins,\n    float4(size(collectcompact(second))) as unique_seconds,\n    float4(size(collectcompact(userAgent))) as unique_user_agents,\n    float4(avg(bytesTransferred)) as bytestransferred,\n    [unique_hours, unique_mins, unique_seconds, unique_user_agents, bytestransferred] as field_0"},{"unitName":"EveryX","path":"expression","variables":["EVERY"],"rawValue":"#{EVERY}","value":"0 0 0 ? * * *"}]},"toBeLoggedItems":[],"currentActiveLoggedItem":"be3c556d-af73-49bf-a623-e5915941b73c","version":"0.1","cells":[{"type":"app.Unit","size":{"width":144,"height":100},"ports":{"groups":{"in":{"position":{"name":"left"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"right","args":{"x":10}}}},"out":{"position":{"name":"right"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"left","args":{"x":-10}}}}},"items":[{"id":"in-in","group":"in","attrs":{".port-label":{"text":"in"}}},{"id":"out-init","group":"out","attrs":{".port-label":{"text":"init"}}},{"id":"out-data","group":"out","attrs":{".port-label":{"text":"data"}}},{"id":"out-error","group":"out","attrs":{".port-label":{"text":"error"}}},{"id":"out-end","group":"out","attrs":{".port-label":{"text":"end"}}}]},"inPorts":["in"],"outPorts":["init","data","error","end"],"position":{"x":-160,"y":-520},"angle":0,"unitType":"devo.DevoFullQuery","unitConf":{"query":"select ? as counter\nfrom demo.ecommerce.data where isnotnull(#{QUERY_COLUMN})\nwhere (abs(hash(#{QUERY_COLUMN}))) %% #{QUERY_MODULE} = counter\nselect\n    hour(eventdate) as hour,\n    minute(eventdate) as minute,\n    second(eventdate) as second,\n    clientIpAddress,\n    userAgent\ngroup every 8h by clientIpAddress\nselect\n    str(clientIpAddress) as sourceIp,\n    float4(size(collectcompact(hour))) as unique_hours,\n    float4(size(collectcompact(minute))) as unique_mins,\n    float4(size(collectcompact(second))) as unique_seconds,\n    float4(size(collectcompact(userAgent))) as unique_user_agents,\n    float4(avg(bytesTransferred)) as bytestransferred,\n    [unique_hours, unique_mins, unique_seconds, unique_user_agents, bytestransferred] as field_0","parameters":["counter"],"mapOn":"","columns":{},"retries":0,"killCurrentQueries":false,"fromEvent":{"endTime":"toTime","startTime":"fromTime"}},"allowOrthogonalResize":false,"id":"cf7bd6c5-495a-4436-b366-74695683285c","name":"Unit_4__QueryData","showFullType":true,"z":1,"isMoving":true,"attrs":{".":{"data-tooltip-class-name":"small","data-tooltip-position":"left","data-tooltip-position-selector":".joint-stencil"}}},{"type":"app.Unit","size":{"width":144,"height":100},"ports":{"groups":{"in":{"position":{"name":"left"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"right","args":{"x":10}}}},"out":{"position":{"name":"right"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"left","args":{"x":-10}}}}},"items":[{"id":"in-data","group":"in","attrs":{".port-label":{"text":"data"}}},{"id":"in-model","group":"in","attrs":{".port-label":{"text":"model"}}},{"id":"out-out","group":"out","attrs":{".port-label":{"text":"out"}}},{"id":"out-discarded","group":"out","attrs":{".port-label":{"text":"discarded"}}},{"id":"out-error","group":"out","attrs":{".port-label":{"text":"error"}}}]},"inPorts":["data","model"],"outPorts":["out","discarded","error"],"position":{"x":90,"y":-520},"angle":0,"clientWidth":154,"clientHeight":134.5,"unitType":"ml.MlSingleModelEval","unitConf":{"modelName":"entity_classification_ip","outResultField":"result","overwrite":false},"allowOrthogonalResize":false,"id":"be3c556d-af73-49bf-a623-e5915941b73c","name":"Unit_6__ModelEvaluator","showFullType":true,"sourceStencil":true,"z":1,"isMoving":true,"attrs":{".":{"data-tooltip-class-name":"small","data-tooltip-position":"left","data-tooltip-position-selector":".joint-stencil"}}},{"type":"app.Unit","size":{"width":144,"height":100},"ports":{"groups":{"in":{"position":{"name":"left"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"right","args":{"x":10}}}},"out":{"position":{"name":"right"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"left","args":{"x":-10}}}}},"items":[{"id":"in-in","group":"in","attrs":{".port-label":{"text":"in"}}},{"id":"out-out","group":"out","attrs":{".port-label":{"text":"out"}}}]},"inPorts":["in"],"outPorts":["out"],"position":{"x":-410,"y":-520},"angle":0,"clientWidth":154,"clientHeight":134.5,"unitType":"event.Repeater","unitConf":{"times":24,"countFieldName":"counter"},"allowOrthogonalResize":false,"id":"3dbee0ed-5fae-4ce5-a21c-41feca7d0716","name":"Unit_3__MultiplyByNToSplitQuery","showFullType":true,"sourceStencil":true,"z":1,"isMoving":true,"attrs":{".":{"data-tooltip-class-name":"small","data-tooltip-position":"left","data-tooltip-position-selector":".joint-stencil"}}},{"type":"app.Unit","size":{"width":144,"height":100},"ports":{"groups":{"in":{"position":{"name":"left"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"right","args":{"x":10}}}},"out":{"position":{"name":"right"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"left","args":{"x":-10}}}}},"items":[{"id":"in-in","group":"in","attrs":{".port-label":{"text":"in"}}},{"id":"out-out","group":"out","attrs":{".port-label":{"text":"out"}}},{"id":"out-error","group":"out","attrs":{".port-label":{"text":"error"}}}]},"inPorts":["in"],"outPorts":["out","error"],"position":{"x":-660,"y":-520},"angle":0,"unitType":"core.Map","unitConf":{"language":"groovy","expressions":{"fields":[{"expression":"schedulerDate.getTime()","overwrite":true,"name":"toTime","type":"java.lang.Long"},{"expression":"toTime - #{QUERY_DURATION}","overwrite":false,"name":"fromTime","type":"java.lang.Long"}]},"fieldsToRemove":{"strings":["schedulerDate"]}},"allowOrthogonalResize":false,"id":"68906236-df06-457a-8f57-2546c02b82cd","showFullType":true,"z":1,"isMoving":true,"name":"Unit_2__SetFromAndToDates","description":"","attrs":{".":{"data-tooltip-class-name":"small","data-tooltip-position":"left","data-tooltip-position-selector":".joint-stencil"}}},{"type":"app.Unit","size":{"width":144,"height":100},"ports":{"groups":{"in":{"position":{"name":"left"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"right","args":{"x":10}}}},"out":{"position":{"name":"right"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"left","args":{"x":-10}}}}},"items":[{"id":"in-do","group":"in","attrs":{".port-label":{"text":"do"}}},{"id":"in-stop","group":"in","attrs":{".port-label":{"text":"stop"}}},{"id":"out-out","group":"out","attrs":{".port-label":{"text":"out"}}},{"id":"out-error","group":"out","attrs":{".port-label":{"text":"error"}}}]},"inPorts":["do","stop"],"outPorts":["out","error"],"position":{"x":-910,"y":-520},"angle":0,"clientWidth":154,"clientHeight":134.5,"unitType":"event.Scheduler","unitConf":{"expression":"#{EVERY}","autostart":true,"timeFieldName":"schedulerDate","counterFieldName":"","timezone":"GMT"},"allowOrthogonalResize":false,"id":"82ab2158-f7b8-4c87-b8ae-f7888835b466","name":"Unit_1__EveryX","showFullType":true,"sourceStencil":true,"z":1,"isMoving":true,"attrs":{".":{"data-tooltip-class-name":"small","data-tooltip-position":"left","data-tooltip-position-selector":".joint-stencil"}}},{"type":"app.Unit","size":{"width":144,"height":100},"ports":{"groups":{"in":{"position":{"name":"left"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"right","args":{"x":10}}}},"out":{"position":{"name":"right"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"left","args":{"x":-10}}}}},"items":[{"id":"out-data","group":"out","attrs":{".port-label":{"text":"data"}}},{"id":"out-error","group":"out","attrs":{".port-label":{"text":"error"}}}]},"inPorts":[],"outPorts":["data","error"],"position":{"x":-160,"y":-290},"angle":0,"clientWidth":154,"clientHeight":134.5,"unitType":"ml.MlUpdateNotifier","unitConf":{"waitOnError":16000,"checkDBConfiguration":false,"endWhenNoMoreData":false,"notifyFirstStallOnly":false,"ensureAllData":true,"saturationEnabled":false,"exploded":false,"lookBackCycles":0,"queryPriority":"normal","timezone":"UTC"},"allowOrthogonalResize":false,"id":"477823bc-d73d-429f-9ca8-657851ddedf2","name":"Unit_5__CheckModelUpdates","showFullType":true,"sourceStencil":true,"z":1,"isMoving":true,"attrs":{".":{"data-tooltip-class-name":"small","data-tooltip-position":"left","data-tooltip-position-selector":".joint-stencil"}}},{"type":"app.Unit","size":{"width":144,"height":100},"ports":{"groups":{"in":{"position":{"name":"left"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"right","args":{"x":10}}}},"out":{"position":{"name":"right"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"left","args":{"x":-10}}}}},"items":[{"id":"in-in","group":"in","attrs":{".port-label":{"text":"in"}}},{"id":"out-out","group":"out","attrs":{".port-label":{"text":"out"}}},{"id":"out-error","group":"out","attrs":{".port-label":{"text":"error"}}}]},"inPorts":["in"],"outPorts":["out","error"],"position":{"x":320,"y":-520},"angle":0,"clientWidth":154,"clientHeight":134.5,"unitType":"core.Map","unitConf":{"language":"groovy","expressions":{"fields":[{"expression":"result[0]","overwrite":false,"name":"classification","type":"java.lang.Float"}]},"fieldsToRemove":{"strings":["schedulerDate","counter","field_0","result","clientIpAddress","unique_hours","unique_mins","unique_seconds","unique_user_agents"]}},"allowOrthogonalResize":false,"id":"9431bee8-a319-4d3d-a9d0-14e30118e5e0","name":"Unit_7__FormatEvents","showFullType":true,"sourceStencil":true,"z":1,"isMoving":true,"description":"","attrs":{".":{"data-tooltip-class-name":"small","data-tooltip-position":"left","data-tooltip-position-selector":".joint-stencil"}}},{"type":"app.Unit","size":{"width":144,"height":100},"ports":{"groups":{"in":{"position":{"name":"left"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"right","args":{"x":10}}}},"out":{"position":{"name":"right"},"attrs":{".port-body":{"magnet":true},".port-label":{"_index":1}},"label":{"position":{"name":"left","args":{"x":-10}}}}},"items":[{"id":"in-in","group":"in","attrs":{".port-label":{"text":"in"}}},{"id":"out-done","group":"out","attrs":{".port-label":{"text":"done"}}},{"id":"out-error","group":"out","attrs":{".port-label":{"text":"error"}}}]},"inPorts":["in"],"outPorts":["done","error"],"position":{"x":550,"y":-520},"angle":0,"unitType":"devo.DevoSink","unitConf":{"table":"#{OUT_TABLE}","autoRefreshTableColumns":false},"allowOrthogonalResize":false,"id":"eaccb0fe-841a-4290-99b8-ccda2a31f7aa","name":"Unit_8__InjectResults","showFullType":true,"z":1,"isMoving":true,"attrs":{".":{"data-tooltip-class-name":"small","data-tooltip-position":"left","data-tooltip-position-selector":".joint-stencil"}}},{"type":"app.Link","router":{"name":"manhattan","args":{"step":5}},"connector":{"name":"rounded","args":{"radius":10}},"toolMarkup":"","z":10000,"source":{"id":"cf7bd6c5-495a-4436-b366-74695683285c","port":"out-data"},"target":{"id":"be3c556d-af73-49bf-a623-e5915941b73c","port":"in-data"},"id":"09669831-b1e8-4118-94f3-f7eba7965644","labels":[],"attrs":{}},{"type":"app.Link","router":{"name":"manhattan","args":{"step":5}},"connector":{"name":"rounded","args":{"radius":10}},"toolMarkup":"","z":10000,"source":{"id":"3dbee0ed-5fae-4ce5-a21c-41feca7d0716","port":"out-out"},"target":{"id":"cf7bd6c5-495a-4436-b366-74695683285c","port":"in-in"},"id":"141e5f4c-470c-4dd0-a150-bc65fe4c7757","labels":[],"attrs":{}},{"type":"app.Link","router":{"name":"manhattan","args":{"step":5}},"connector":{"name":"rounded","args":{"radius":10}},"toolMarkup":"","z":10000,"source":{"id":"68906236-df06-457a-8f57-2546c02b82cd","port":"out-out"},"target":{"id":"3dbee0ed-5fae-4ce5-a21c-41feca7d0716","port":"in-in"},"id":"1d716e17-aba6-4b32-a69b-f9c7e022026b","labels":[],"attrs":{}},{"type":"app.Link","router":{"name":"manhattan","args":{"step":5}},"connector":{"name":"rounded","args":{"radius":10}},"toolMarkup":"","z":10000,"source":{"id":"82ab2158-f7b8-4c87-b8ae-f7888835b466","port":"out-out"},"target":{"id":"68906236-df06-457a-8f57-2546c02b82cd","port":"in-in"},"id":"fc613a54-7a85-42c1-8768-53251d4370bf","labels":[],"attrs":{}},{"type":"app.Link","router":{"name":"manhattan","args":{"step":5}},"connector":{"name":"rounded","args":{"radius":10}},"toolMarkup":"","z":10000,"source":{"id":"477823bc-d73d-429f-9ca8-657851ddedf2","port":"out-data"},"target":{"id":"be3c556d-af73-49bf-a623-e5915941b73c","port":"in-model"},"id":"4df0a5d9-71a6-44f7-8826-d989f63002c3","labels":[],"attrs":{}},{"type":"app.Link","router":{"name":"manhattan","args":{"step":5}},"connector":{"name":"rounded","args":{"radius":10}},"toolMarkup":"","z":10000,"source":{"id":"be3c556d-af73-49bf-a623-e5915941b73c","port":"out-out"},"target":{"id":"9431bee8-a319-4d3d-a9d0-14e30118e5e0","port":"in-in"},"id":"b41e729c-7d0d-4346-8308-9dcfe5f712ca","labels":[],"attrs":{}},{"type":"app.Link","router":{"name":"manhattan","args":{"step":5}},"connector":{"name":"rounded","args":{"radius":10}},"toolMarkup":"","z":10000,"source":{"id":"9431bee8-a319-4d3d-a9d0-14e30118e5e0","port":"out-out"},"target":{"id":"eaccb0fe-841a-4290-99b8-ccda2a31f7aa","port":"in-in"},"id":"32e6f1d2-675e-42dc-8440-6e8a6c12f85b","labels":[],"attrs":{}}],"linksOrder":[{"source":{"name":"repeater1","port":"out"},"target":{"name":"query_data","port":"in"}},{"source":{"name":"query_data","port":"data"},"target":{"name":"mlSingleModelEval1","port":"data"}},{"source":{"name":"mlSingleModelEval1","port":"out"},"target":{"name":"map1","port":"in"}},{"source":{"name":"map1","port":"out"},"target":{"name":"devoSink1","port":"in"}},{"source":{"name":"scheduler1","port":"out"},"target":{"name":"set_init_dates","port":"in"}},{"source":{"name":"set_init_dates","port":"out"},"target":{"name":"repeater1","port":"in"}},{"source":{"name":"tick1","port":"out"},"target":{"name":"set_init_dates","port":"in"}}]}